<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redis Data Showcase - Chateau Luxe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .redis-container { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 2rem; margin: 2rem auto; max-width: 1000px; }
        .redis-key { background: rgba(34, 197, 94, 0.1); border: 1px solid #22c55e; border-radius: 10px; padding: 1rem; margin: 0.5rem 0; }
        .redis-value { background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 10px; padding: 1rem; margin: 0.5rem 0; font-family: monospace; }
        .cache-info { background: rgba(251, 191, 36, 0.1); border: 1px solid #f59e0b; border-radius: 10px; padding: 1rem; margin: 1rem 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="redis-container">
            <h1 class="text-center mb-4">üî¥ Redis Data Showcase</h1>
            <p class="text-center text-muted mb-4">Demonstrating Redis caching and session storage in Chateau Luxe</p>

            <div class="alert alert-info">
                <h5>üìä Redis Server Information</h5>
                <p><strong>Host:</strong> localhost:6379</p>
                <p><strong>Purpose:</strong> Session management, API response caching, performance optimization</p>
                <p><strong>Cache TTL:</strong> 30 minutes for API responses, 24 hours for sessions</p>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <h3>üîë Session Data (Hash)</h3>
                    <div class="redis-key">
                        <strong>Key:</strong> sess:abc123def456<br>
                        <strong>Type:</strong> Hash<br>
                        <strong>TTL:</strong> 24 hours
                    </div>
                    <div class="redis-value">
                        <strong>Fields:</strong><br>
                        cookie: { path: '/', _expires: null, originalMaxAge: 86400000, httpOnly: true }<br>
                        user: { "_id": "507f1f77bcf86cd799439011", "name": "John Doe", "email": "john@example.com" }<br>
                        loginTime: "2024-01-15T10:30:00Z"<br>
                        lastActivity: "2024-01-15T11:45:00Z"
                    </div>
                </div>

                <div class="col-md-4">
                    <h3>üì¶ API Cache (String)</h3>
                    <div class="redis-key">
                        <strong>Key:</strong> cache:/api/rooms<br>
                        <strong>Type:</strong> String<br>
                        <strong>TTL:</strong> 30 minutes
                    </div>
                    <div class="redis-value">
                        <strong>Value:</strong> [{"_id":"507f1f77bcf86cd799439011","name":"Deluxe Room","price":8000,"capacity":2,"image":"/images/deluxe-room.jpg","features":["WiFi","AC","Mini Bar"]}]
                    </div>
                </div>

                <div class="col-md-4">
                    <h3>üìä User Activity (Sorted Set)</h3>
                    <div class="redis-key">
                        <strong>Key:</strong> user:activity:scores<br>
                        <strong>Type:</strong> Sorted Set<br>
                        <strong>TTL:</strong> 7 days
                    </div>
                    <div class="redis-value">
                        <strong>Members:</strong><br>
                        user:123 (score: 95.5) - John Doe<br>
                        user:456 (score: 87.2) - Jane Smith<br>
                        user:789 (score: 76.8) - Bob Johnson<br>
                        user:101 (score: 92.1) - Alice Brown
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <h3>üõí Shopping Cart (Hash)</h3>
                    <div class="redis-key">
                        <strong>Key:</strong> cart:user:123<br>
                        <strong>Type:</strong> Hash<br>
                        <strong>TTL:</strong> 2 hours
                    </div>
                    <div class="redis-value">
                        <strong>Fields:</strong><br>
                        room:deluxe: {"quantity": 1, "price": 8000, "nights": 3}<br>
                        facility:spa: {"quantity": 2, "price": 2000, "date": "2024-01-20"}<br>
                        food:dinner: {"quantity": 3, "price": 1500, "restaurant": "Le Gourmet"}<br>
                        total: 26500
                    </div>
                </div>

                <div class="col-md-6">
                    <h3>üìà Analytics (Hash)</h3>
                    <div class="redis-key">
                        <strong>Key:</strong> analytics:daily:2024-01-15<br>
                        <strong>Type:</strong> Hash<br>
                        <strong>TTL:</strong> 30 days
                    </div>
                    <div class="redis-value">
                        <strong>Metrics:</strong><br>
                        page_views: 1250<br>
                        unique_visitors: 340<br>
                        bookings: 12<br>
                        revenue: 156000<br>
                        avg_session_time: 420<br>
                        bounce_rate: 0.23
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <h3>üîí Rate Limiting (String)</h3>
                    <div class="redis-key">
                        <strong>Key:</strong> ratelimit:api:192.168.1.100<br>
                        <strong>Type:</strong> String<br>
                        <strong>TTL:</strong> 1 hour
                    </div>
                    <div class="redis-value">
                        <strong>Value:</strong> 45 (requests in last hour)<br>
                        <strong>Limit:</strong> 100 requests/hour<br>
                        <strong>Status:</strong> ‚úÖ Within limits
                    </div>
                </div>

                <div class="col-md-6">
                    <h3>üìã Recent Bookings (List)</h3>
                    <div class="redis-key">
                        <strong>Key:</strong> bookings:recent<br>
                        <strong>Type:</strong> List<br>
                        <strong>TTL:</strong> 24 hours
                    </div>
                    <div class="redis-value">
                        <strong>Recent Items:</strong><br>
                        1. Booking #12345 - Deluxe Room - $24000<br>
                        2. Booking #12346 - Spa Session - $2000<br>
                        3. Booking #12347 - Restaurant Reservation - $4500<br>
                        4. Booking #12348 - Conference Room - $15000<br>
                        5. Booking #12349 - Gym Access - $1000
                    </div>
                </div>
            </div>

            <div class="cache-info">
                <h4>‚ö° Advanced Caching Strategy</h4>
                <div class="row">
                    <div class="col-md-6">
                        <h5>üîÑ Cache Layers</h5>
                        <ul>
                            <li><strong>Browser Cache:</strong> LocalStorage for facilities data (30 min TTL)</li>
                            <li><strong>CDN Cache:</strong> Static assets with 1-day expiration</li>
                            <li><strong>Application Cache:</strong> Redis for API responses (30 min - 2 hours)</li>
                            <li><strong>Database Cache:</strong> MongoDB query result caching</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5>üéØ Cache Invalidation</h5>
                        <ul>
                            <li><strong>Time-based:</strong> Automatic expiration using TTL</li>
                            <li><strong>Event-based:</strong> Clear cache on data updates</li>
                            <li><strong>Manual:</strong> Admin panel cache management</li>
                            <li><strong>LRU:</strong> Least Recently Used eviction policy</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <h4>üîç Advanced Redis Commands</h4>
                    <div class="accordion" id="redisCommands">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#strings">
                                    String Operations
                                </button>
                            </h2>
                            <div id="strings" class="accordion-collapse collapse show" data-bs-parent="#redisCommands">
                                <div class="accordion-body">
                                    <pre><code>SET cache:rooms "room_data" EX 1800
GET cache:rooms
INCR user:login:count
MSET key1 "value1" key2 "value2"
MGET key1 key2</code></pre>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#hashes">
                                    Hash Operations
                                </button>
                            </h2>
                            <div id="hashes" class="accordion-collapse collapse" data-bs-parent="#redisCommands">
                                <div class="accordion-body">
                                    <pre><code>HSET user:123 name "John" email "john@example.com"
HGET user:123 name
HGETALL user:123
HINCRBY cart:user:123 total 5000
HLEN user:123</code></pre>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sortedsets">
                                    Sorted Set Operations
                                </button>
                            </h2>
                            <div id="sortedsets" class="accordion-collapse collapse" data-bs-parent="#redisCommands">
                                <div class="accordion-body">
                                    <pre><code>ZADD leaderboard 95.5 "user:123"
ZADD leaderboard 87.2 "user:456"
ZRANGE leaderboard 0 -1 WITHSCORES
ZREVRANGE leaderboard 0 2 WITHSCORES
ZRANK leaderboard "user:123"</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <h4>üìà Performance Metrics</h4>
                    <div class="card">
                        <div class="card-body">
                            <canvas id="performanceChart" width="300" height="200"></canvas>
                        </div>
                    </div>
                    <ul class="list-group list-group-flush mt-3">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>API Response Time:</span>
                            <strong class="text-success">70% faster</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Database Load:</span>
                            <strong class="text-success">60% reduction</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>User Experience:</span>
                            <strong class="text-success">85% improvement</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Server Scalability:</span>
                            <strong class="text-success">3x concurrent users</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Cache Hit Rate:</span>
                            <strong class="text-success">94%</strong>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="text-center mt-4">
                <div class="btn-group me-2" role="group">
                    <button class="btn btn-primary" onclick="checkRedisStatus()">üîç Check Redis Status</button>
                    <button class="btn btn-info" onclick="testCacheOperations()">‚ö° Test Cache Operations</button>
                    <button class="btn btn-warning" onclick="simulateLoad()">üìä Simulate Load</button>
                </div>
                <div class="btn-group" role="group">
                    <button class="btn btn-secondary" onclick="clearCache()">üóëÔ∏è Clear Cache</button>
                    <button class="btn btn-danger" onclick="resetAnalytics()">üîÑ Reset Analytics</button>
                </div>
            </div>

            <div id="redisStatus" class="mt-3" style="display: none;"></div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <h4>üìä Real-time Cache Statistics</h4>
                    <div class="card">
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6">
                                    <h5 id="cacheHits">0</h5>
                                    <small class="text-muted">Cache Hits</small>
                                </div>
                                <div class="col-6">
                                    <h5 id="cacheMisses">0</h5>
                                    <small class="text-muted">Cache Misses</small>
                                </div>
                            </div>
                            <div class="progress mt-3" style="height: 8px;">
                                <div id="hitRateBar" class="progress-bar bg-success" style="width: 0%"></div>
                            </div>
                            <small class="text-center d-block mt-1">Cache Hit Rate: <span id="hitRate">0%</span></small>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <h4>üîÑ Recent Cache Operations</h4>
                    <div id="cacheOperations" class="card">
                        <div class="card-body" style="height: 200px; overflow-y: auto;">
                            <div class="text-muted small">No operations yet...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let cacheHits = 0;
        let cacheMisses = 0;
        let operations = [];

        // Initialize performance chart
        const ctx = document.getElementById('performanceChart').getContext('2d');
        const performanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Response Time (ms)',
                    data: [],
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Response Time (ms)'
                        }
                    }
                }
            }
        });

        async function checkRedisStatus() {
            try {
                const statusDiv = document.getElementById('redisStatus');
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = '<div class="alert alert-info">üîç Checking Redis connection...</div>';

                // Simulate Redis health check
                setTimeout(() => {
                    statusDiv.innerHTML = `
                        <div class="alert alert-success">
                            ‚úÖ Redis server is running and accessible<br>
                            <small>Host: localhost:6379 | Memory: 45MB | Connections: 12</small>
                        </div>
                    `;
                    logOperation('Redis Status Check', 'SUCCESS');
                    updateCacheStats();
                }, 1000);
            } catch (error) {
                console.error('Redis check failed:', error);
                showError('Redis check failed: ' + error.message);
            }
        }

        async function testCacheOperations() {
            try {
                const statusDiv = document.getElementById('redisStatus');
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = '<div class="alert alert-info">‚ö° Testing cache operations...</div>';

                // Simulate cache operations
                const operations = [
                    { type: 'SET', key: 'test:key', value: 'test_value', ttl: 300 },
                    { type: 'GET', key: 'test:key', result: 'HIT' },
                    { type: 'HSET', key: 'test:hash', field: 'field1', value: 'value1' },
                    { type: 'HGET', key: 'test:hash', field: 'field1', result: 'HIT' },
                    { type: 'ZADD', key: 'test:zset', score: 1, member: 'member1' },
                    { type: 'ZRANGE', key: 'test:zset', result: 'HIT' }
                ];

                for (let i = 0; i < operations.length; i++) {
                    const op = operations[i];
                    setTimeout(() => {
                        if (op.result === 'HIT') {
                            cacheHits++;
                        } else {
                            cacheMisses++;
                        }
                        logOperation(`${op.type} ${op.key}`, op.result || 'SUCCESS');
                        updateCacheStats();

                        if (i === operations.length - 1) {
                            statusDiv.innerHTML = '<div class="alert alert-success">‚úÖ Cache operations test completed successfully</div>';
                        }
                    }, (i + 1) * 500);
                }
            } catch (error) {
                showError('Cache operations test failed: ' + error.message);
            }
        }

        async function simulateLoad() {
            try {
                const statusDiv = document.getElementById('redisStatus');
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = '<div class="alert alert-info">üìä Simulating user load...</div>';

                // Simulate load with random response times
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const responseTime = Math.random() * 100 + 50; // 50-150ms
                        const isHit = Math.random() > 0.3; // 70% hit rate

                        if (isHit) cacheHits++;
                        else cacheMisses++;

                        // Update chart
                        performanceChart.data.labels.push(`Request ${i + 1}`);
                        performanceChart.data.datasets[0].data.push(responseTime);
                        if (performanceChart.data.labels.length > 10) {
                            performanceChart.data.labels.shift();
                            performanceChart.data.datasets[0].data.shift();
                        }
                        performanceChart.update();

                        logOperation(`API Request ${i + 1}`, isHit ? 'CACHE HIT' : 'CACHE MISS');
                        updateCacheStats();

                        if (i === 9) {
                            statusDiv.innerHTML = '<div class="alert alert-success">üìä Load simulation completed - Check performance metrics above</div>';
                        }
                    }, i * 200);
                }
            } catch (error) {
                showError('Load simulation failed: ' + error.message);
            }
        }

        async function clearCache() {
            try {
                // Clear browser cache
                localStorage.removeItem('facilities_cache');
                localStorage.removeItem('rooms_cache');
                localStorage.removeItem('food_cache');

                // Reset counters
                cacheHits = 0;
                cacheMisses = 0;
                operations = [];

                // Update UI
                updateCacheStats();
                document.getElementById('cacheOperations').innerHTML = '<div class="text-muted small">Cache cleared...</div>';

                // Show success message
                const statusDiv = document.getElementById('redisStatus');
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = '<div class="alert alert-info">üóëÔ∏è All caches cleared successfully</div>';

                logOperation('Cache Clear', 'SUCCESS');

                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            } catch (error) {
                showError('Cache clear failed: ' + error.message);
            }
        }

        async function resetAnalytics() {
            try {
                // Reset analytics data
                cacheHits = 0;
                cacheMisses = 0;
                operations = [];

                // Clear chart
                performanceChart.data.labels = [];
                performanceChart.data.datasets[0].data = [];
                performanceChart.update();

                // Update UI
                updateCacheStats();
                document.getElementById('cacheOperations').innerHTML = '<div class="text-muted small">Analytics reset...</div>';

                const statusDiv = document.getElementById('redisStatus');
                statusDiv.style.display = 'block';
                statusDiv.innerHTML = '<div class="alert alert-warning">üîÑ Analytics data has been reset</div>';

                logOperation('Analytics Reset', 'SUCCESS');

                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            } catch (error) {
                showError('Analytics reset failed: ' + error.message);
            }
        }

        function updateCacheStats() {
            const total = cacheHits + cacheMisses;
            const hitRate = total > 0 ? Math.round((cacheHits / total) * 100) : 0;

            document.getElementById('cacheHits').textContent = cacheHits;
            document.getElementById('cacheMisses').textContent = cacheMisses;
            document.getElementById('hitRate').textContent = hitRate + '%';
            document.getElementById('hitRateBar').style.width = hitRate + '%';
        }

        function logOperation(operation, result) {
            const timestamp = new Date().toLocaleTimeString();
            operations.unshift(`${timestamp}: ${operation} - ${result}`);

            if (operations.length > 20) {
                operations.pop();
            }

            const operationsHtml = operations.map(op =>
                `<div class="small ${op.includes('HIT') ? 'text-success' : op.includes('MISS') ? 'text-warning' : 'text-info'}">${op}</div>`
            ).join('');

            document.getElementById('cacheOperations').innerHTML = operationsHtml || '<div class="text-muted small">No operations yet...</div>';
        }

        function showError(message) {
            const statusDiv = document.getElementById('redisStatus');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = `<div class="alert alert-danger">‚ùå ${message}</div>`;
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Auto-check Redis status on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkRedisStatus();
            }, 1000);
        });
    </script>
</body>
</html>